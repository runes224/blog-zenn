---
title: "Cognito Ã— Amplify Ã— Vueã§èªè¨¼æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹"
emoji: "ğŸ±â€"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [React, Amplify, AWS, Cognito, Vue]
published: false
---

# å‰æ
  - Cognitoã¨AzureADã®è¨­å®šã¯å®Œäº†æ¸ˆã¿
  - ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€Azureã®ç”»é¢ã«é·ç§»ã—ã¦èªè¨¼æƒ…å ±ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¢ãƒ—ãƒªã«ä¿æŒã™ã‚‹ã¨ã“ã‚ã¾ã§ã‚’å®Ÿè£…
  - Amplifyã®UIã‚’ä½¿ãˆã‚‹ï¼Ÿï¼Ÿ
# å­¦ã³
  - Cognitoã®ãƒ–ãƒ©ãƒƒã‚¯ãƒ™ãƒ«ãƒˆè³‡æ–™ãŒã‚ã¡ã‚ƒåˆ†ã‹ã‚Šã‚„ã™ã„

  [ã€AWS Black Belt Online Seminarã€‘Amazon Cognito](https://www.youtube.com/watch?v=vWfTe5MHOIk&feature=youtu.be)

  [](https://d1.awsstatic.com/webinars/jp/pdf/services/20200630_AWS_BlackBelt_Amazon%20Cognito.pdf)

  - CLIãŒãªãã¦ã‚‚Amplifyãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ä½¿ãˆã‚‹
      - æ—¢å­˜ã®Cognitoã¨Amplifyã®æ¥ç¶šè¨­å®š

      [Amplify Framework Documentation](https://docs.amplify.aws/lib/auth/start/q/platform/js)

  - Amplifyãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã†ã¨Cognitoã¸ã®APIã‚³ãƒ¼ãƒ«ãŒç°¡ç•¥åŒ–ã•ã‚Œã‚‹
  - èªå¯ã‚³ãƒ¼ãƒ‰â†’èªå¯ãƒˆãƒ¼ã‚¯ãƒ³ã®å¤‰æ›ã¾ã§è‡ªå‹•ã§ã‚„ã£ã¦ãã‚Œã‚‹
  - èªè¨¼æƒ…å ±ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã•ã‚Œã€[Authã‚¯ãƒ©ã‚¹](https://aws-amplify.github.io/amplify-js/api/classes/authclass.html)ã‚’é€šã—ã¦ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- è©°ã¾ã£ãŸã¨ã“ã‚
    - æ—¢å­˜ã®Cognitoã¨Amplifyã®æ¥ç¶šè¨­å®šãŒã‚ã‹ã‚‰ãªã‹ã£ãŸ
        - æ¤œç´¢ã™ã‚‹ã¨CLIã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒå‰æã®è¨˜äº‹ãŒå¤šã„
    - Cognitoã®åŸºæœ¬çš„ãªä»•çµ„ã¿ãŒã‚ã‹ã£ã¦ã„ãªã‹ã£ãŸ
        - åŸºæœ¬çš„ã«Amplifyã¯Cognitoã®APIã‚³ãƒ¼ãƒ«ã‚’ç°¡ç•¥åŒ–ã—ã¦ã‚‹ã ã‘
        - Amplifyã‚’ä½¿ã‚ãšã¨ã‚‚Cognitoã®ãƒ­ã‚°ã‚¤ãƒ³ã¯å®Ÿè£…ã§ãã‚‹
    - Amplifyã®UIã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒå‰æã¨ãªã£ã¦ã„ãŸ
        - å¤–éƒ¨IdPã®ãƒ­ã‚°ã‚¤ãƒ³ãƒªãƒ³ã‚¯ã¯UIãŒç”¨æ„ã•ã‚Œã¦ã„ãªã„ã®ã§è‡ªå‰ã§å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
        - UIãŒãªã„â†’Amplifyã‚’ä½¿ã†æ„å‘³ãŒãªã„ã¨æ€ã£ã¦ã„ãŸï¼ˆUIä»¥å¤–ã®æ©Ÿèƒ½ãŒã‚ã‚‹ã¨æ€ã£ã¦ã„ãªã‹ã£ãŸï¼‰
        - å®Ÿéš›ã«ã¯UIã¯ä½¿ã‚ãªãã¨ã‚‚Amplifyãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã¯å®Ÿè£…ã§ãã‚‹
    - Cognitoã®è¨­å®šã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ç”Ÿæˆã—ã¦ãŸ
        - Javascriptã¯ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ã‚»ã‚­ãƒ¥ã‚¢ã«ä¿æŒã§ããªã„ã®ã§ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¯ä¸è¦
- å‚è€ƒ

    [AuthClass | amplify-js](https://aws-amplify.github.io/amplify-js/api/classes/authclass.html)

# ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰

`src/main.js`
```javascript
import Amplify, * as AmplifyModules from 'aws-amplify';

Amplify.configure({
  Auth: {
    region: process.env.VUE_APP_AWS_REGION,
    userPoolId: process.env.VUE_APP_AWS_USER_POOLS_ID,
    userPoolWebClientId: process.env.VUE_APP_AWS_USER_POOLS_CLIENT_ID,
    oauth: {
      domain: process.env.VUE_APP_AWS_OAUTH_DOMAIN,
      scope: [
        'phone',
        'email',
        'profile',
        'openid',
        'aws.cognito.signin.user.admin'
      ],
      redirectSignIn: process.env.VUE_APP_REDIRECT_SIGN_IN_URI,
      redirectSignOut: process.env.VUE_APP_REDIRECT_SIGN_OUT_URI,
      responseType: 'code'
    }
  }
});
Vue.use(AmplifyModules);
```

`components/Auth.vue`
```javascript
<template>
  <div class="Auth">
    <div v-if="state.user">
      ãƒ­ã‚°ã‚¤ãƒ³ä¸­<br />
      ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ï¼š{{ state.user.username }}<br />
      <v-btn @click="signout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</v-btn>
    </div>
    <div v-else>
      ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¦ã„ã¾ã™<br />
      <div>
        <v-btn @click="signin()">Azureã§ãƒ­ã‚°ã‚¤ãƒ³</v-btn>
      </div>
    </div>
  </div>
</template>

<script>
import { reactive } from '@vue/composition-api';
import { Auth } from 'aws-amplify';

export default {
  name: 'Auth',
  setup() {
    const state = reactive({
      user: null
    });

    Auth.currentAuthenticatedUser()
      .then(user => (state.user = user))
      .catch(() => console.log('Not signed in'));
    const signin = () => {
      try {
        Auth.federatedSignIn({
          provider: process.env.VUE_APP_AWS_USER_POOLS_PROVIDER_NAME
        });
      } catch (error) {
        console.log('signing in error:', error);
      }
    };
    const signout = () => {
      try {
        Auth.signOut();
      } catch (error) {
        console.log('signing out error:', error);
      }
    };
    return { state, signin, signout };
  }
};
</script>
```

`src/router/index.js`
```javascript
import Home from '@/views/Home.vue';
import Top from '@/views/Top.vue';
import Vue from 'vue';
import VueRouter from 'vue-router';
import { Auth } from 'aws-amplify';

Vue.use(VueRouter);

const routes = [
  {
    path: '/',
    name: 'Top',
    component: Top,
    meta: {
      isPublic: true
    }
  },
  {
    path: '/home',
    name: 'Home',
    component: Home
  }
];

const router = new VueRouter({
  mode: 'history',
  base: process.env.BASE_URL,
  routes
});

router.beforeEach(async (to, from, next) => {
  const currentAuthenticatedUser = await Auth.currentAuthenticatedUser().catch(
    () => null
  );
  if (
    to.matched.some(page => page.meta.isPublic) ||
    currentAuthenticatedUser !== null
  ) {
    next();
  } else {
    next('/');
  }
});

export default router;
```

